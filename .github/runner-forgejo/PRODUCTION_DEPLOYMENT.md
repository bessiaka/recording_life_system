# üöÄ Production Deployment Setup Guide

## üìù –û–±–∑–æ—Ä

–ü–æ—Å–ª–µ —É—Å–ø–µ—à–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ CI/CD –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã, —ç—Ç–æ—Ç –≥–∞–π–¥ –ø–æ–º–æ–∂–µ—Ç –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å **–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π –≤ production** –ø—Ä–∏ merge –≤ main –≤–µ—Ç–∫—É.

---

## ‚úÖ –ü—Ä–µ–¥–≤–∞—Ä–∏—Ç–µ–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

- [x] Runner —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç –Ω–∞ Server (192.168.1.72)
- [x] Runner –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –Ω–∞ Forgejo
- [x] –û–±—Ä–∞–∑—ã –¥–ª—è labels —Å–æ–±—Ä–∞–Ω—ã (`forgejo-runner-optimized:debian`)
- [x] –¢–µ—Å—Ç–æ–≤—ã–π workflow —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω
- [x] `.env.production` —Å–æ–∑–¥–∞–Ω –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –¥–µ–ø–ª–æ—è

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Desktop (192.168.1.73)                                      ‚îÇ
‚îÇ   git push origin feature-branch                            ‚îÇ
‚îÇ   Create PR ‚Üí Merge to main                                 ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Forgejo Server (95.165.70.94:1080)                          ‚îÇ
‚îÇ   Webhook triggered on push to main                         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Runner Container (Server 192.168.1.72)                      ‚îÇ
‚îÇ   Receives workflow job                                     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Job Container (forgejo-runner-optimized:debian)             ‚îÇ
‚îÇ   ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê         ‚îÇ
‚îÇ   ‚îÇ 1. Checkout code (actions/checkout@v4)       ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 2. Validate .env.production exists            ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 3. Validate docker-compose.yml                ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 4. docker compose down                        ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 5. docker compose build --no-cache            ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 6. docker compose up -d                       ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 7. Health check                               ‚îÇ         ‚îÇ
‚îÇ   ‚îÇ 8. Cleanup old images                         ‚îÇ         ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò         ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                          ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ Production Application Containers (Server)                   ‚îÇ
‚îÇ   Application deployed and running                          ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

---

## üìã –®–∞–≥ 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ production –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### 1.1. –ü—Ä–æ–≤–µ—Ä–∫–∞ .env.production

–ù–∞ Server —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `.env.production` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ:

```bash
cd /home/bessiaka/WORKSPACE/recording_life_system
cat .env.production
```

**–í–∞–∂–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:**
- Production database credentials
- Production API keys
- Production ports
- Production URLs

### 1.2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker Compose –¥–ª—è production

–£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.env.production`:

```yaml
services:
  app:
    env_file:
      - .env.production
    # ... –æ—Å—Ç–∞–ª—å–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
```

---

## üìã –®–∞–≥ 2: –ê–∫—Ç–∏–≤–∞—Ü–∏—è production workflow

### 2.1. Workflow —É–∂–µ —Å–æ–∑–¥–∞–Ω

–§–∞–π–ª `.forgejo/workflows/deploy-production.yml` —É–∂–µ —Å–æ–∑–¥–∞–Ω —Å–æ —Å–ª–µ–¥—É—é—â–∏–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏:

‚úÖ **–¢—Ä–∏–≥–≥–µ—Ä—ã:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ push –≤ `main`
- –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ Web UI (workflow_dispatch)

‚úÖ **–®–∞–≥–∏ –¥–µ–ø–ª–æ—è:**
1. Checkout –∫–æ–¥–∞
2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è (Node.js, Python, Docker)
3. –í–∞–ª–∏–¥–∞—Ü–∏—è `.env.production`
4. –í–∞–ª–∏–¥–∞—Ü–∏—è `docker-compose.yml`
5. –û—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å—Ç–∞—Ä—ã—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
6. –°–±–æ—Ä–∫–∞ –Ω–æ–≤—ã—Ö –æ–±—Ä–∞–∑–æ–≤
7. –ó–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
8. Health check
9. –û—á–∏—Å—Ç–∫–∞ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤
10. –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á–µ—Ç

### 2.2. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ workflow

**–í–∞—Ä–∏–∞–Ω—Ç 1: –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ (–±–µ–∑–æ–ø–∞—Å–Ω–æ)**

1. –û—Ç–∫—Ä–æ–π—Ç–µ Forgejo: http://95.165.70.94:1080/bessiaka/recording_life_system
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ: Actions ‚Üí Workflows
3. –í—ã–±–µ—Ä–∏—Ç–µ: "Deploy to Production"
4. –ù–∞–∂–º–∏—Ç–µ: "Run workflow"
5. Branch: `main`
6. –ù–∞–∂–º–∏—Ç–µ: "Run workflow"

**–í–∞—Ä–∏–∞–Ω—Ç 2: –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ –ø—Ä–∏ merge**

```bash
# –ù–∞ Desktop
cd ~/WORKSPACE/WORKSPACE_LOCAL_GITLAB/todo-voice-app

# –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç
echo "test" >> README.md
git add README.md
git commit -m "test: trigger production deployment"

# Push –≤ main (–í–ù–ò–ú–ê–ù–ò–ï: —ç—Ç–æ –∑–∞–ø—É—Å—Ç–∏—Ç production –¥–µ–ø–ª–æ–π!)
git push origin main
```

---

## üìã –®–∞–≥ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è

### 3.1. –ù–∞–±–ª—é–¥–µ–Ω–∏–µ –∑–∞ workflow –≤ Forgejo UI

1. –û—Ç–∫—Ä–æ–π—Ç–µ: Actions ‚Üí Runs
2. –ù–∞–π–¥–∏—Ç–µ –∑–∞–ø—É—â–µ–Ω–Ω—ã–π "Deploy to Production"
3. –ö–ª–∏–∫–Ω–∏—Ç–µ –Ω–∞ run –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –ª–æ–≥–æ–≤
4. –°–ª–µ–¥–∏—Ç–µ –∑–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∫–∞–∂–¥–æ–≥–æ step

### 3.2. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞ Server

**–í —Ç–µ—Ä–º–∏–Ω–∞–ª–µ Server:**

```bash
# –¢–µ—Ä–º–∏–Ω–∞–ª 1: –õ–æ–≥–∏ runner
cd /home/bessiaka/WORKSPACE/recording_life_system/.github/runner-forgejo
docker compose logs -f

# –¢–µ—Ä–º–∏–Ω–∞–ª 2: –°–ø–∏—Å–æ–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤ (–æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∫–∞–∂–¥—É—é —Å–µ–∫—É–Ω–¥—É)
watch -n 1 'docker ps'

# –¢–µ—Ä–º–∏–Ω–∞–ª 3: –õ–æ–≥–∏ application containers
cd /home/bessiaka/WORKSPACE/recording_life_system
docker compose logs -f
```

### 3.3. –ß—Ç–æ –¥–æ–ª–∂–Ω–æ –ø—Ä–æ–∏–∑–æ–π—Ç–∏

**–í–æ –≤—Ä–µ–º—è –¥–µ–ø–ª–æ—è:**

```
1. Job container —Å–æ–∑–¥–∞–µ—Ç—Å—è
2. Checkout –∫–æ–¥–∞
3. –°—Ç–∞—Ä—ã–µ application containers –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è
4. –ù–æ–≤—ã–µ –æ–±—Ä–∞–∑—ã —Å–æ–±–∏—Ä–∞—é—Ç—Å—è
5. –ù–æ–≤—ã–µ application containers –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è
6. Health check –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∞—Ç—É—Å
7. Job container —É–¥–∞–ª—è–µ—Ç—Å—è
```

**–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è:**

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∞—Ç—É—Å–∞ application
docker compose ps

# –î–æ–ª–∂–Ω—ã –±—ã—Ç—å –∑–∞–ø—É—â–µ–Ω—ã –≤—Å–µ —Å–µ—Ä–≤–∏—Å—ã
```

---

## üîß –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 4.1. –ó–∞—â–∏—Ç–∞ main –≤–µ—Ç–∫–∏

–í Forgejo –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Branch Protection –¥–ª—è `main`:

1. Settings ‚Üí Repository ‚Üí Protected branches
2. Branch name pattern: `main`
3. Enable:
   - ‚úÖ Require pull request reviews before merging
   - ‚úÖ Require status checks to pass before merging
   - ‚úÖ Require branches to be up to date before merging

### 4.2. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ pre-deploy —Ç–µ—Å—Ç–æ–≤

–ú–æ–¥–∏—Ñ–∏—Ü–∏—Ä—É–π—Ç–µ `.forgejo/workflows/deploy-production.yml`:

```yaml
# –î–æ–±–∞–≤—å—Ç–µ –ø–µ—Ä–µ–¥ deploy job
jobs:
  test:
    runs-on: alpine
    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Run tests
        run: |
          # –í–∞—à–∏ —Ç–µ—Å—Ç—ã –∑–¥–µ—Å—å
          npm test || python -m pytest

  deploy:
    needs: test  # ‚Üê –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ —Ç–µ—Å—Ç—ã –ø—Ä–æ—à–ª–∏
    runs-on: alpine
    # ... –æ—Å—Ç–∞–ª—å–Ω—ã–µ —à–∞–≥–∏
```

---

## üìä –®–∞–≥ 5: Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞

### 5.1. –û—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏

–ï—Å–ª–∏ –¥–µ–ø–ª–æ–π –ø—Ä–æ—à–µ–ª –Ω–µ—É–¥–∞—á–Ω–æ:

```bash
# –ù–∞ Server
cd /home/bessiaka/WORKSPACE/recording_life_system

# –í–∞—Ä–∏–∞–Ω—Ç 1: –û—Ç–∫–∞—Ç —á–µ—Ä–µ–∑ git
git log --oneline -5  # –ù–∞–π—Ç–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–π –∫–æ–º–º–∏—Ç
git checkout <previous-commit-hash>
docker compose down
docker compose build
docker compose up -d

# –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —Å—Ç–∞—Ä—ã—Ö –æ–±—Ä–∞–∑–æ–≤
docker compose down
docker compose up -d  # –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞—Ä—ã–µ –æ–±—Ä–∞–∑—ã
```

### 5.2. –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π rollback

–î–æ–±–∞–≤—å—Ç–µ –≤ workflow:

```yaml
- name: Rollback on failure
  if: failure()
  run: |
    echo "‚ö†Ô∏è Deployment failed, rolling back..."
    docker compose down
    # –í–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–µ–¥—ã–¥—É—â–µ–π –≤–µ—Ä—Å–∏–∏
    git checkout HEAD~1
    docker compose up -d
```

---

## üéØ –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π workflow

### Production deployment –ø—Ä–æ—Ü–µ—Å—Å:

```
1. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –≤ feature –≤–µ—Ç–∫–µ
   ‚îî‚Üí git checkout -b feature/new-feature

2. –ö–æ–º–º–∏—Ç—ã –∏ push
   ‚îî‚Üí git push origin feature/new-feature

3. –°–æ–∑–¥–∞–Ω–∏–µ Pull Request –≤ Forgejo
   ‚îî‚Üí Web UI: Create Pull Request ‚Üí main

4. Code Review (–µ—Å–ª–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ)
   ‚îî‚Üí Review ‚Üí Approve

5. Merge –≤ main
   ‚îî‚Üí –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –∑–∞–ø—É—Å–∫ deploy-production.yml

6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–µ–ø–ª–æ—è
   ‚îî‚Üí Actions ‚Üí Runs ‚Üí Deploy to Production

7. –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤ production
   ‚îî‚Üí http://95.165.70.94:8000 (–∏–ª–∏ –≤–∞—à production URL)
```

---

## üìù –ß–∞—Å—Ç—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞: "Deployment failed: container exited"

**–ü—Ä–∏—á–∏–Ω–∞:** Application container —É–ø–∞–ª –ø–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
docker compose logs app_container_name

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å health status
docker compose ps
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Health check failed"

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ –≤—Å–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–∞–∫–∏–µ —Å–µ—Ä–≤–∏—Å—ã –Ω–µ –∑–∞–ø—É—Å—Ç–∏–ª–∏—Å—å
docker compose ps --filter "status=exited"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ –ø—Ä–æ–±–ª–µ–º–Ω–æ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
docker compose logs service_name
```

### –ü—Ä–æ–±–ª–µ–º–∞: "Permission denied: /var/run/docker.sock"

**–ü—Ä–∏—á–∏–Ω–∞:** Runner –Ω–µ –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø–∞ –∫ Docker socket.

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ù–∞ Server
sudo chmod 666 /var/run/docker.sock

# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å runner –≤ docker –≥—Ä—É–ø–ø—É (–≤ docker-compose.yml)
```

---

## ‚úÖ –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏

- [ ] `.env.production` –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- [ ] `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.env.production`
- [ ] Branch protection –≤–∫–ª—é—á–µ–Ω –¥–ª—è `main`
- [ ] –¢–µ—Å—Ç–æ–≤—ã–π workflow –ø—Ä–æ—à–µ–ª —É—Å–ø–µ—à–Ω–æ
- [ ] Production deployment workflow –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω
- [ ] Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞
- [ ] –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (–ª–æ–≥–∏, health checks)
- [ ] Team –∑–Ω–∞–µ—Ç –ø—Ä–æ—Ü–µ—Å—Å –¥–µ–ø–ª–æ—è

---

## üéâ –ò—Ç–æ–≥

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ—Ö —à–∞–≥–æ–≤ —É –≤–∞—Å –±—É–¥–µ—Ç:

1. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –¥–µ–ø–ª–æ–π** –ø—Ä–∏ merge –≤ main
2. ‚úÖ **–†—É—á–Ω–æ–π –¥–µ–ø–ª–æ–π** —á–µ—Ä–µ–∑ Forgejo Web UI
3. ‚úÖ **Health checks** –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—Ç–∞—Ç—É—Å–∞
4. ‚úÖ **Rollback –ø—Ä–æ—Ü–µ–¥—É—Ä–∞** –¥–ª—è –æ—Ç–∫–∞—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
5. ‚úÖ **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** —á–µ—Ä–µ–∑ –ª–æ–≥–∏ –∏ Forgejo UI

**CI/CD pipeline –≥–æ—Ç–æ–≤ –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üöÄ

---

## üìû –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ runner: `docker compose logs -f` –≤ `.github/runner-forgejo/`
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ application: `docker compose logs -f` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Forgejo Actions UI –¥–ª—è –¥–µ—Ç–∞–ª–µ–π workflow –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è
4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Å—Ç–∞—Ç—É—Å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤: `docker ps -a`
