name: Test Deploy Workflow (Temporary)

# ========================================
# –¢–ï–°–¢–û–í–´–ô WORKFLOW - –£–î–ê–õ–ò–¢–¨ –ü–û–°–õ–ï –ü–†–û–í–ï–†–ö–ò
# ========================================
# –≠—Ç–æ—Ç workflow –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø—Ä–∏ push –≤ –≤–µ—Ç–∫—É claude/setup-github-actions-cicd-F5yxE
# –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–∞–±–æ—Ç—ã CI/CD –ø–µ—Ä–µ–¥ merge –≤ main

on:
  push:
    branches:
      - claude/setup-github-actions-cicd-F5yxE

jobs:
  test-deploy:
    runs-on: alpine

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Test - Print environment info
        run: |
          echo "========================================="
          echo "üß™ –¢–ï–°–¢–û–í–´–ô –ó–ê–ü–£–°–ö WORKFLOW"
          echo "========================================="
          echo "–í–µ—Ç–∫–∞: ${{ github.ref_name }}"
          echo "–ö–æ–º–º–∏—Ç: ${{ github.sha }}"
          echo "–ê–≤—Ç–æ—Ä: ${{ github.actor }}"
          echo "–†–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π: ${{ github.repository }}"
          echo "========================================="

      - name: Test - Check .env.production exists
        run: |
          if [ -f ".env.production" ]; then
            echo "‚úÖ .env.production –Ω–∞–π–¥–µ–Ω"
            echo "–°–æ–¥–µ—Ä–∂–∏–º–æ–µ:"
            cat .env.production
          else
            echo "‚ùå .env.production –ù–ï –Ω–∞–π–¥–µ–Ω"
            echo "–°–æ–∑–¥–∞–π—Ç–µ –µ–≥–æ –Ω–∞ Server –ø–µ—Ä–µ–¥ production –¥–µ–ø–ª–æ–µ–º"
            exit 1
          fi

      - name: Test - Check Docker Compose config
        run: |
          echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ Docker Compose –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏..."
          if ! command -v docker &> /dev/null; then
            echo "‚ùå Docker –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ runner"
            echo "–î–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç–µ –Ω–∞ Server:"
            echo "  docker compose --env-file=.env.production config"
            exit 0
          fi

          docker compose --env-file=.env.production config || true

      - name: Test - Dry run (–±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –¥–µ–ø–ª–æ—è)
        run: |
          echo "========================================="
          echo "‚úÖ WORKFLOW –†–ê–ë–û–¢–ê–ï–¢ –ö–û–†–†–ï–ö–¢–ù–û!"
          echo "========================================="
          echo "–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ –¥–ª—è production:"
          echo "1. –£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç —Ç–µ—Å—Ç–æ–≤—ã–π workflow"
          echo "2. –ó–∞–º–µ—Ä–∂–∏—Ç—å –≤–µ—Ç–∫—É –≤ main"
          echo "3. Push –≤ main –∑–∞–ø—É—Å—Ç–∏—Ç —Ä–µ–∞–ª—å–Ω—ã–π –¥–µ–ø–ª–æ–π"
          echo "========================================="

      - name: Test - Success notification
        run: |
          echo "üéâ –¢–µ—Å—Ç —É—Å–ø–µ—à–Ω–æ –ø—Ä–æ–π–¥–µ–Ω!"
          echo "Workflow –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –∏ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ"
